<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:p="http://primefaces.org/ui" template="../template.xhtml">

	<ui:define name="content">
		<f:metadata>
			<f:viewAction action="#{spacesController.onLoad}" />
		</f:metadata>
		<p:layout id="spaceLayout">
			<p:layoutUnit position="west">
				<h:form id="formData">
					<p:growl id="msgs" showDetail="true" escape="false" />

					<h3 style="margin-top: 0">${labels.spaces}</h3>
					<p:tree value="#{spacesController.root}" var="item"
						selectionMode="single"
						selection="#{spacesController.selectedNode}" dynamic="true">

						<p:ajax event="select" update=":formShowDetail, :formData:msgs"
							listener="#{spacesController.onNodeSelect}" />

						<p:treeNode type="site" expandedIcon="ui-icon-folder-open"
							collapsedIcon="ui-icon-folder-collapsed">
							<h:outputText value="#{item.name}" />
						</p:treeNode>
						<p:treeNode type="floor" expandedIcon="ui-icon-folder-open"
							collapsedIcon="ui-icon-folder-collapsed">
							<h:outputText value="#{item.name}" />
						</p:treeNode>
						<p:treeNode type="sector" expandedIcon="ui-icon-folder-open"
							collapsedIcon="ui-icon-folder-collapsed">
							<h:outputText value="#{item.name}" />
						</p:treeNode>
					</p:tree>
				</h:form>
			</p:layoutUnit>

			<p:layoutUnit position="center">
				<h:form id="formShowDetail">
					<p:panel visible="#{spacesController.visibleDetailSite}">
						<p:panelGrid columns="2" var="site">
							<f:facet name="header">${labels.site}</f:facet>
							<h:outputText value="#{labels.site_id} :" />
							<h:outputText value="#{spacesController.selectedSite.id}" />

							<h:outputText value="#{labels.site_name} :" />
							<h:outputText value="#{spacesController.selectedSite.name}" />

							<h:outputText value="#{labels.site_description} :" />
							<h:outputText
								value="#{spacesController.selectedSite.description}" />
							<f:facet name="footer">
								<h:inputHidden value="#{spacesController.selectedSite.id}" />
								<p:separator />

								<p:commandButton id="btnUpdate"
									update=":formUpdate:dlgUpdateSite"
									oncomplete="PF('dlgUpdateSite').show()" icon="ui-icon-pencil"
									title="#{labels.button_update}" value="#{labels.button_update}"
									actionListener="#{spacesController.displaySelectedSite}">
								</p:commandButton>

								<p:commandButton id="btnDelete" update=":formDelete:message"
									oncomplete="PF('confirmDialog').show()" icon="ui-icon-trash"
									title="#{labels.button_delete}" value="#{labels.button_delete}">
									<f:setPropertyActionListener value="#{site}"
										target="#{spacesController.selectedSite}" />
								</p:commandButton>
							</f:facet>
						</p:panelGrid>
					</p:panel>
				</h:form>
			</p:layoutUnit>
		</p:layout>

		<!-- ############################################ -->
		<!-- #											# -->
		<!-- #											# -->
		<!-- #	Form para Edição do item selecionado	# -->
		<!-- #											# -->
		<!-- #											# -->
		<!-- ############################################ -->
		<h:form id="formUpdate">
			<p:dialog header="#{labels.site_update}" widgetVar="dlgUpdateSite"
				modal="true" showEffect="fade" hideEffect="explode"
				resizable="false">
				<p:outputPanel id="dlgUpdateSite" style="text-align:center;">
					<p:panelGrid columns="2">
						<h:outputText value="#{labels.site_name}:" />
						<p:inputText value="#{spacesController.selectedSite.name}" />

						<h:outputText value="#{labels.site_description}" />
						<p:inputText value="#{spacesController.selectedSite.description}" />
						<f:facet name="footer">
							<h:inputHidden value="#{spacesController.selectedSite.id}" />
							<p:separator />
							<p:commandButton id="btnUpdateSave"
								update=":formData, :formData:msgs, :formShowDetail"
								actionListener="#{spacesController.updateSite}"
								oncomplete="handleUpdateRequest(xhr, status, args)"
								icon="ui-icon-disk" title="#{labels.button_save}"
								value="#{labels.button_save}" />
							<p:commandButton id="btnUpdateCancel"
								oncomplete="PF('dlgUpdateSite').hide()" icon="ui-icon-cancel"
								title="#{labels.button_cancel}" value="#{labels.button_cancel}" />
						</f:facet>
					</p:panelGrid>
				</p:outputPanel>
			</p:dialog>
		</h:form>
		<script type="text/javascript">
    function handleUpdateRequest(xhr, status, args) {
        if(!args.saved) {
            PF('dlgUpdateSite').jq.effect("shake", {times:5}, 100);
        }
        else {
            PF('dlgUpdateSite').hide();
        }
    }
</script>

		<!-- ############################################ -->
		<!-- #											# -->
		<!-- #	Form para exclusão do item selecionado	# -->
		<!-- #			  Requer confirmação			# -->
		<!-- #											# -->
		<!-- #											# -->
		<!-- ############################################ -->

		<h:form id="formDelete">
			<p:growl id="message" showDetail="true" />

			<p:confirmDialog id="confirmDialog" widgetVar="confirmDialog"
				header="#{labels.button_delete}"
				message="#{labels.site_confirm_delete}" icon="ui-icon-alert"
				showEffect="fade" hideEffect="fade">
				<p:commandButton value="#{labels.button_yes}"
					actionListener="#{spacesController.delete}"
					styleClass="ui-confirmdialog-yes" icon="ui-icon-check"
					update=":formData, :formData:msgs, :formShowDetail"
					oncomplete="PF('confirmDialog').hide();" />
				<p:commandButton value="#{labels.button_no}" type="button"
					styleClass="ui-confirmdialog-no"
					onclick="PF('confirmDialog').hide();" icon="ui-icon-close" />
			</p:confirmDialog>
		</h:form>

	</ui:define>
</ui:composition>
